<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home | TeamUp</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="home_style.css">
    <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body class="bg-gray-900 text-white">

    <header class="bg-gray-900/80 backdrop-blur-sm sticky top-0 z-50 border-b border-gray-700/50">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
            <div class="text-2xl font-bold text-white">
                <span class="text-purple-400">Team</span>Up
            </div>
            <div class="hidden md:flex items-center space-x-8">
                <a href="#" class="nav-link hover:text-purple-400 transition">Home</a>
                <a href="../hackathonpage/hackathons.html" class="nav-link hover:text-purple-400 transition">Find Teams</a>
                <a href="#" class="nav-link hover:text-purple-400 transition">About</a>
                <a href="#" class="nav-link hover:text-purple-400 transition">Contact</a>
                <button id="logout-btn" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition">Logout</button>
            </div>
            <button class="md:hidden text-white">
                <i data-lucide="menu"></i>
            </button>
        </nav>
    </header>

    <main class="container mx-auto px-6 py-12">
        <section class="mb-20 flex justify-center">
            <div id="player-profile-card" class="player-card bg-gray-800/90 border border-gray-700 shadow-2xl rounded-2xl p-8 w-full max-w-5xl transition-all duration-300">
                <div class="player-card-content">
                    <div class="flex flex-col sm:flex-row justify-between items-start gap-6">
                        <div class="flex flex-col sm:flex-row items-center gap-10">
                            <div class="avatar-container flex-shrink-0">
                                <svg class="w-28 h-28 text-indigo-300" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg>
                            </div>
                            <div class="text-center sm:text-left">
                                <h1 class="text-4xl font-bold text-white">Ada Lovelace</h1>
                                <p class="text-blue-400 font-mono mt-1 text-lg">ID: user_7a2b9c4d</p>
                                <p class="text-gray-400 mt-3 text-lg">Frontend Developer | Hackathon Enthusiast</p>
                            </div>
                        </div>
                        
                        <div class="flex items-center self-center sm:self-start space-x-3 bg-gray-900/50 border border-gray-700 px-4 py-2 rounded-lg">
                            <label for="availability-toggle" class="font-semibold text-gray-300 select-none cursor-pointer">Available</label>
                            <input type="checkbox" id="availability-toggle" class="h-5 w-5 rounded border-gray-600 bg-gray-700 text-green-500 focus:ring-green-500 focus:ring-offset-gray-800 cursor-pointer">
                        </div>
                    </div>

                    <div class="mt-10 border-t border-gray-700 pt-6">
                        <h3 class="text-sm font-semibold text-gray-400 uppercase tracking-wider mb-4">Core Skills</h3>
                        <div id="skills-container" class="flex flex-wrap gap-3">
                            <span class="skill-pill bg-green-500/30 text-green-300 px-4 py-1.5 rounded-full text-base">
                                Dummy Skill 1
                            </span>
                            <span class="skill-pill bg-blue-500/30 text-blue-300 px-4 py-1.5 rounded-full text-base">
                                Dummy Skill 2
                            </span>
                            <span class="skill-pill bg-pink-500/30 text-pink-300 px-4 py-1.5 rounded-full text-base">
                                Dummy Skill 3
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section>
            <div class="text-center mb-12">
                <h2 class="text-4xl font-extrabold text-white">Find Your Arena</h2>
                <p class="text-gray-400 mt-2 max-w-2xl mx-auto">Select a domain to start searching for teams or create your own.</p>
            </div>

            <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-8">
                <a href="../hackathonpage/hackathons.html" class="domain-card bg-gray-800/80 border border-gray-700 rounded-2xl shadow-lg hover:shadow-purple-500/40 hover:scale-[1.03] transition transform cursor-pointer">
                    <div class="image-placeholder bg-blue-500/10 flex justify-center items-center py-8">
                        <i data-lucide="laptop" class="w-16 h-16 text-blue-400"></i>
                    </div>
                    <div class="p-6">
                        <h3 class="text-2xl font-bold">Hackathons</h3>
                        <p class="text-gray-400 mt-2 mb-4">Code, collaborate, and create innovative solutions.</p>
                        <button class="w-full bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 rounded-lg transition">Find Teams</button>
                    </div>
                </a>

                <a href="esports.html" class="domain-card bg-gray-800/80 border border-gray-700 rounded-2xl shadow-lg hover:shadow-red-500/40 hover:scale-[1.03] transition transform cursor-pointer">
                    <div class="image-placeholder bg-red-500/10 flex justify-center items-center py-8">
                        <i data-lucide="gamepad-2" class="w-16 h-16 text-red-400"></i>
                    </div>
                    <div class="p-6">
                        <h3 class="text-2xl font-bold">Esports</h3>
                        <p class="text-gray-400 mt-2 mb-4">Compete with the best and rise to the top of the leaderboards.</p>
                        <button class="w-full bg-red-500 hover:bg-red-600 text-white font-semibold py-2 rounded-lg transition">Find Teams</button>
                    </div>
                </a>

                <a href="icpc.html" class="domain-card bg-gray-800/80 border border-gray-700 rounded-2xl shadow-lg hover:shadow-green-500/40 hover:scale-[1.03] transition transform cursor-pointer">
                    <div class="image-placeholder bg-green-500/10 flex justify-center items-center py-8">
                        <i data-lucide="code" class="w-16 h-16 text-green-400"></i>
                    </div>
                    <div class="p-6">
                        <h3 class="text-2xl font-bold">ICPC</h3>
                        <p class="text-gray-400 mt-2 mb-4">Solve complex problems in competitive programming.</p>
                        <button class="w-full bg-green-500 hover:bg-green-600 text-white font-semibold py-2 rounded-lg transition">Find Teams</button>
                    </div>
                </a>

                <a href="study.html" class="domain-card bg-gray-800/80 border border-gray-700 rounded-2xl shadow-lg hover:shadow-yellow-500/40 hover:scale-[1.03] transition transform cursor-pointer">
                    <div class="image-placeholder bg-yellow-500/10 flex justify-center items-center py-8">
                        <i data-lucide="book-open" class="w-16 h-16 text-yellow-400"></i>
                    </div>
                    <div class="p-6">
                        <h3 class="text-2xl font-bold">Study Groups</h3>
                        <p class="text-gray-400 mt-2 mb-4">Learn together and excel in your academic goals.</p>
                        <button class="w-full bg-yellow-500 hover:bg-yellow-600 text-gray-900 font-semibold py-2 rounded-lg transition">Find Teams</button>
                    </div>
                </a>
            </div>
        </section>
    </main>

    <script>
        lucide.createIcons();

        // Configuration
        const API_BASE_URL = 'http://localhost:5000/api';

        // Check for logged-in user session first
        function getLoggedInUser() {
            // Check both localStorage and sessionStorage for user session
            const sessionData = localStorage.getItem('userSession') || sessionStorage.getItem('userSession');
            
            if (sessionData) {
                try {
                    const session = JSON.parse(sessionData);
                    const loginTime = new Date(session.loginTime);
                    const now = new Date();
                    const hoursSinceLogin = (now - loginTime) / (1000 * 60 * 60);
                    
                    // Check if session is still valid (within 24 hours for localStorage, always valid for sessionStorage)
                    const isLocalStorage = localStorage.getItem('userSession');
                    if (!isLocalStorage || hoursSinceLogin < 24) {
                        return session;
                    } else {
                        // Session expired, clear it
                        localStorage.removeItem('userSession');
                        return null;
                    }
                } catch (error) {
                    console.error('Error parsing session data:', error);
                    localStorage.removeItem('userSession');
                    sessionStorage.removeItem('userSession');
                    return null;
                }
            }
            return null;
        }

        // Load user profile - check session first, then API
        async function loadUserProfile() {
            // First check if user is logged in
            const loggedInUser = getLoggedInUser();
            
            if (loggedInUser) {
                console.log('Loading profile for logged-in user:', loggedInUser.name);
                // Try to fetch detailed profile from API for the logged-in user
                try {
                    const userDetailResponse = await fetch(`${API_BASE_URL}/users/${loggedInUser.userId}?include_skills=true`);
                    if (userDetailResponse.ok) {
                        const userDetailData = await userDetailResponse.json();
                        if (userDetailData.success) {
                            updateProfileUI(userDetailData.user);
                            return;
                        }
                    }
                } catch (error) {
                    console.error('Error fetching detailed profile from API:', error);
                }
                
                // Fallback to session data if API call fails
                updateProfileUI({
                    name: loggedInUser.name,
                    user_id: loggedInUser.userId,
                    email: loggedInUser.email,
                    bio: "Team Builder | Hackathon Enthusiast"
                });
                return;
            }

            // If no session, redirect to login
            console.log('No valid session found, redirecting to login');
            window.location.href = '../login/signin.html';
        }

        // Update UI with user profile data
        function updateProfileUI(user) {
            // Update name and ID
            const nameElement = document.querySelector('h1');
            const idElement = document.querySelector('.text-blue-400');
            
            if (nameElement) nameElement.textContent = user.name || 'Unknown User';
            if (idElement) idElement.textContent = `ID: user_${user.user_id}`;

            // Update bio/description if available
            const bioElement = document.querySelector('.text-gray-400');
            if (bioElement) {
                if (user.bio) {
                    bioElement.textContent = user.bio;
                } else if (user.experience) {
                    bioElement.textContent = `${user.experience} | Team Builder`;
                } else if (user.location) {
                    bioElement.textContent = `Developer from ${user.location} | Team Builder`;
                } else {
                    bioElement.textContent = `Developer | Hackathon Enthusiast`;
                }
            }

            // Update skills if available
            const skillsContainer = document.getElementById("skills-container");
            if (user.skills && user.skills.length > 0 && skillsContainer) {
                skillsContainer.innerHTML = "";
                user.skills.forEach((skillObj, index) => {
                    const span = document.createElement("span");
                    // Cycle through different colors
                    const colors = [
                        'bg-cyan-500/30 text-cyan-300',
                        'bg-green-500/30 text-green-300', 
                        'bg-blue-500/30 text-blue-300',
                        'bg-pink-500/30 text-pink-300',
                        'bg-purple-500/30 text-purple-300',
                        'bg-yellow-500/30 text-yellow-300'
                    ];
                    span.className = `skill-pill ${colors[index % colors.length]} px-4 py-1.5 rounded-full text-base`;
                    span.innerText = skillObj.skill_name || skillObj;
                    skillsContainer.appendChild(span);
                });
            } else {
                // Fallback to localStorage skills if no backend skills
                handleStoredSkills();
            }

            // Update profile logo if available
            if (user.profile_logo && user.profile_logo !== 'default') {
                updateProfileAvatar(user.profile_logo);
            }

            console.log('Loaded user profile:', user.name, 'ID:', user.user_id);
        }

        // Load demo profile as fallback
        function loadDemoProfile() {
            const demoUser = {
                name: "Ada Lovelace",
                user_id: "7a2b9c4d",
                bio: "Frontend Developer | Hackathon Enthusiast",
                skills: [
                    { skill_name: "JavaScript" },
                    { skill_name: "React" },
                    { skill_name: "Python" }
                ]
            };
            updateProfileUI(demoUser);
        }

        // Handle stored skills from localStorage (existing functionality)
        function handleStoredSkills() {
            const skillsContainer = document.getElementById("skills-container");
            const storedSkills = JSON.parse(localStorage.getItem("selectedSkills")) || [];

            if (storedSkills.length > 0) {
                skillsContainer.innerHTML = "";
                storedSkills.forEach(skill => {
                    const span = document.createElement("span");
                    span.className = "bg-cyan-500/30 text-cyan-300 px-4 py-1.5 rounded-full text-base";
                    span.innerText = skill;
                    skillsContainer.appendChild(span);
                });
            }
        }

        // Update profile avatar (future feature)
        function updateProfileAvatar(profileLogo) {
            // This could be expanded to show different avatar types
            console.log('Profile logo:', profileLogo);
        }

        // Handle logout
        function handleLogout() {
            // Clear all user session data
            localStorage.removeItem('userSession');
            sessionStorage.removeItem('userSession');
            localStorage.removeItem('rememberedEmail'); // Optional: also clear remembered email
            
            console.log('User logged out successfully');
            
            // Redirect to login page
            window.location.href = '../login/signin.html';
        }

        document.addEventListener("DOMContentLoaded", () => {
            // Load user profile data from backend
            loadUserProfile();

            // Add logout button event listener
            const logoutBtn = document.getElementById('logout-btn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', handleLogout);
            }

            // --- Handle Availability Toggle Glow ---
            const availabilityToggle = document.getElementById("availability-toggle");
            const playerCard = document.getElementById("player-profile-card");

            availabilityToggle.addEventListener("change", function() {
                if (this.checked) {
                    // Add glowing effect classes
                    playerCard.classList.add("shadow-purple-500/40", "border-purple-500/50");
                } else {
                    // Remove glowing effect classes
                    playerCard.classList.remove("shadow-purple-500/40", "border-purple-500/50");
                }
            });
        });
    </script>
</body>
</html>